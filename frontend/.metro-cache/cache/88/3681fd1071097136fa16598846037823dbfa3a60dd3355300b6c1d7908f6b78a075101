{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":78,"index":78}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"../services/auth.service","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":79},"end":{"line":2,"column":61,"index":140}}],"key":"OAwOj13pryMi7HegghVkxChHnhI=","exportNames":["*"],"imports":1}},{"name":"../store/authStore","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":141},"end":{"line":3,"column":50,"index":191}}],"key":"/4BDl/hqolvw7T4CXD8jWAtZK4M=","exportNames":["*"],"imports":1}},{"name":"../services/notifications.service","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":192},"end":{"line":4,"column":114,"index":306}}],"key":"wN7e6rqBf7ZuKvH36NXG+/TSRnI=","exportNames":["*"],"imports":1}},{"name":"react/jsx-dev-runtime","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"L9D70Z4hi4aGuui1ysja/oQ5ytI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _jsxFileName = \"/app/frontend/contexts/AuthContext.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"AuthProvider\", {\n    enumerable: true,\n    get: function () {\n      return AuthProvider;\n    }\n  });\n  Object.defineProperty(exports, \"useAuth\", {\n    enumerable: true,\n    get: function () {\n      return useAuth;\n    }\n  });\n  var _react = require(_dependencyMap[0], \"react\");\n  var _servicesAuthService = require(_dependencyMap[1], \"../services/auth.service\");\n  var authService = _interopDefault(_servicesAuthService);\n  var _storeAuthStore = require(_dependencyMap[2], \"../store/authStore\");\n  var _servicesNotificationsService = require(_dependencyMap[3], \"../services/notifications.service\");\n  var _reactJsxDevRuntime = require(_dependencyMap[4], \"react/jsx-dev-runtime\");\n  const AuthContext = /*#__PURE__*/(0, _react.createContext)(undefined);\n  const AuthProvider = ({\n    children\n  }) => {\n    _s();\n    const {\n      user,\n      isLoading,\n      isAuthenticated,\n      setUser,\n      setLoading,\n      logout: storeLogout\n    } = (0, _storeAuthStore.useAuthStore)();\n    const [showConsentModal, setShowConsentModal] = (0, _react.useState)(false);\n    (0, _react.useEffect)(() => {\n      checkAuth();\n    }, []);\n    const checkAuth = async () => {\n      try {\n        setLoading(true);\n        const token = await authService.default.getToken();\n        if (token) {\n          const currentUser = await authService.default.getCurrentUser();\n          if (currentUser) {\n            setUser(currentUser);\n          } else {\n            setUser(null);\n          }\n        } else {\n          setUser(null);\n        }\n      } catch (error) {\n        console.error('Auth check error:', error);\n        setUser(null);\n      } finally {\n        setLoading(false);\n      }\n    };\n    const login = async (email, password, stayLoggedIn = true) => {\n      try {\n        const {\n          user\n        } = await authService.default.login({\n          email,\n          password\n        }, stayLoggedIn);\n        setUser(user);\n\n        // Check if user needs to accept terms/privacy\n        if (user.needs_consent) {\n          setShowConsentModal(true);\n        }\n\n        // Register for push notifications after successful login\n        // Note: Push notifications work via device tokens and persist even when logged out\n        (0, _servicesNotificationsService.registerForPushNotificationsAsync)().catch(error => {\n          console.error('Failed to register for push notifications:', error);\n        });\n      } catch (error) {\n        throw new Error(error.response?.data?.detail || 'Login failed');\n      }\n    };\n    const handleConsentAccepted = () => {\n      setShowConsentModal(false);\n      // Update user to reflect consent has been accepted\n      if (user) {\n        setUser(Object.assign({}, user, {\n          needs_consent: false,\n          terms_accepted: true,\n          privacy_policy_accepted: true\n        }));\n      }\n    };\n    const register = async data => {\n      try {\n        const {\n          user\n        } = await authService.default.register(data);\n        setUser(user);\n      } catch (error) {\n        throw new Error(error.response?.data?.detail || 'Registration failed');\n      }\n    };\n    const logout = async () => {\n      await authService.default.logout();\n      storeLogout();\n    };\n    const updateUser = updatedUser => {\n      if (user) {\n        setUser(Object.assign({}, user, updatedUser));\n      }\n    };\n    return /*#__PURE__*/(0, _reactJsxDevRuntime.jsxDEV)(AuthContext.Provider, {\n      value: {\n        user,\n        isLoading,\n        isAuthenticated,\n        login,\n        register,\n        logout,\n        updateUser\n      },\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 5\n    }, this);\n  };\n  _s(AuthProvider, \"5Od3Pf7S4XDYgFlPpClHBgMia7s=\", false, function () {\n    return [_storeAuthStore.useAuthStore];\n  });\n  _c = AuthProvider;\n  const useAuth = () => {\n    _s2();\n    const context = (0, _react.useContext)(AuthContext);\n    if (!context) {\n      throw new Error('useAuth must be used within AuthProvider');\n    }\n    return context;\n  };\n  _s2(useAuth, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\n  var _c;\n  $RefreshReg$(_c, \"AuthProvider\");\n});","lineCount":157,"map":[[15,2,19,0,"Object"],[15,8,19,0],[15,9,19,0,"defineProperty"],[15,23,19,0],[15,24,19,0,"exports"],[15,31,19,0],[16,4,19,0,"enumerable"],[16,14,19,0],[17,4,19,0,"get"],[17,7,19,0],[17,18,19,0,"get"],[17,19,19,0],[18,6,19,0],[18,13,19,0,"AuthProvider"],[18,25,19,0],[19,4,19,0],[20,2,19,0],[21,2,105,0,"Object"],[21,8,105,0],[21,9,105,0,"defineProperty"],[21,23,105,0],[21,24,105,0,"exports"],[21,31,105,0],[22,4,105,0,"enumerable"],[22,14,105,0],[23,4,105,0,"get"],[23,7,105,0],[23,18,105,0,"get"],[23,19,105,0],[24,6,105,0],[24,13,105,0,"useAuth"],[24,20,105,0],[25,4,105,0],[26,2,105,0],[27,2,1,0],[27,6,1,0,"_react"],[27,12,1,0],[27,15,1,0,"require"],[27,22,1,0],[27,23,1,0,"_dependencyMap"],[27,37,1,0],[28,2,2,0],[28,6,2,0,"_servicesAuthService"],[28,26,2,0],[28,29,2,0,"require"],[28,36,2,0],[28,37,2,0,"_dependencyMap"],[28,51,2,0],[29,2,2,0],[29,6,2,0,"authService"],[29,17,2,0],[29,20,2,0,"_interopDefault"],[29,35,2,0],[29,36,2,0,"_servicesAuthService"],[29,56,2,0],[30,2,3,0],[30,6,3,0,"_storeAuthStore"],[30,21,3,0],[30,24,3,0,"require"],[30,31,3,0],[30,32,3,0,"_dependencyMap"],[30,46,3,0],[31,2,4,0],[31,6,4,0,"_servicesNotificationsService"],[31,35,4,0],[31,38,4,0,"require"],[31,45,4,0],[31,46,4,0,"_dependencyMap"],[31,60,4,0],[32,2,4,114],[32,6,4,114,"_reactJsxDevRuntime"],[32,25,4,114],[32,28,4,114,"require"],[32,35,4,114],[32,36,4,114,"_dependencyMap"],[32,50,4,114],[33,2,17,0],[33,8,17,6,"AuthContext"],[33,19,17,17],[33,35,17,20],[33,39,17,20,"createContext"],[33,45,17,33],[33,46,17,33,"createContext"],[33,59,17,33],[33,61,17,63,"undefined"],[33,70,17,72],[33,71,17,73],[34,2,19,7],[34,8,19,13,"AuthProvider"],[34,20,19,66],[34,23,19,69,"AuthProvider"],[34,24,19,70],[35,4,19,72,"children"],[36,2,19,81],[36,3,19,82],[36,8,19,87],[37,4,19,87,"_s"],[37,6,19,87],[38,4,20,2],[38,10,20,8],[39,6,20,10,"user"],[39,10,20,14],[40,6,20,16,"isLoading"],[40,15,20,25],[41,6,20,27,"isAuthenticated"],[41,21,20,42],[42,6,20,44,"setUser"],[42,13,20,51],[43,6,20,53,"setLoading"],[43,16,20,63],[44,6,20,65,"logout"],[44,12,20,71],[44,14,20,73,"storeLogout"],[45,4,20,85],[45,5,20,86],[45,8,20,89],[45,12,20,89,"useAuthStore"],[45,27,20,101],[45,28,20,101,"useAuthStore"],[45,40,20,101],[45,42,20,102],[45,43,20,103],[46,4,21,2],[46,10,21,8],[46,11,21,9,"showConsentModal"],[46,27,21,25],[46,29,21,27,"setShowConsentModal"],[46,48,21,46],[46,49,21,47],[46,52,21,50],[46,56,21,50,"useState"],[46,62,21,58],[46,63,21,58,"useState"],[46,71,21,58],[46,73,21,59],[46,78,21,64],[46,79,21,65],[47,4,23,2],[47,8,23,2,"useEffect"],[47,14,23,11],[47,15,23,11,"useEffect"],[47,24,23,11],[47,26,23,12],[47,32,23,18],[48,6,24,4,"checkAuth"],[48,15,24,13],[48,16,24,14],[48,17,24,15],[49,4,25,2],[49,5,25,3],[49,7,25,5],[49,9,25,7],[49,10,25,8],[50,4,27,2],[50,10,27,8,"checkAuth"],[50,19,27,17],[50,22,27,20],[50,28,27,20,"checkAuth"],[50,29,27,20],[50,34,27,32],[51,6,28,4],[51,10,28,8],[52,8,29,6,"setLoading"],[52,18,29,16],[52,19,29,17],[52,23,29,21],[52,24,29,22],[53,8,30,6],[53,14,30,12,"token"],[53,19,30,17],[53,22,30,20],[53,28,30,26,"authService"],[53,39,30,37],[53,40,30,37,"default"],[53,47,30,37],[53,48,30,38,"getToken"],[53,56,30,46],[53,57,30,47],[53,58,30,48],[54,8,32,6],[54,12,32,10,"token"],[54,17,32,15],[54,19,32,17],[55,10,33,8],[55,16,33,14,"currentUser"],[55,27,33,25],[55,30,33,28],[55,36,33,34,"authService"],[55,47,33,45],[55,48,33,45,"default"],[55,55,33,45],[55,56,33,46,"getCurrentUser"],[55,70,33,60],[55,71,33,61],[55,72,33,62],[56,10,34,8],[56,14,34,12,"currentUser"],[56,25,34,23],[56,27,34,25],[57,12,35,10,"setUser"],[57,19,35,17],[57,20,35,18,"currentUser"],[57,31,35,29],[57,32,35,30],[58,10,36,8],[58,11,36,9],[58,17,36,15],[59,12,37,10,"setUser"],[59,19,37,17],[59,20,37,18],[59,24,37,22],[59,25,37,23],[60,10,38,8],[61,8,39,6],[61,9,39,7],[61,15,39,13],[62,10,40,8,"setUser"],[62,17,40,15],[62,18,40,16],[62,22,40,20],[62,23,40,21],[63,8,41,6],[64,6,42,4],[64,7,42,5],[64,8,42,6],[64,15,42,13,"error"],[64,20,42,18],[64,22,42,20],[65,8,43,6,"console"],[65,15,43,13],[65,16,43,14,"error"],[65,21,43,19],[65,22,43,20],[65,41,43,39],[65,43,43,41,"error"],[65,48,43,46],[65,49,43,47],[66,8,44,6,"setUser"],[66,15,44,13],[66,16,44,14],[66,20,44,18],[66,21,44,19],[67,6,45,4],[67,7,45,5],[67,16,45,14],[68,8,46,6,"setLoading"],[68,18,46,16],[68,19,46,17],[68,24,46,22],[68,25,46,23],[69,6,47,4],[70,4,48,2],[70,5,48,3],[71,4,50,2],[71,10,50,8,"login"],[71,15,50,13],[71,18,50,16],[71,24,50,16,"login"],[71,25,50,23,"email"],[71,30,50,36],[71,32,50,38,"password"],[71,40,50,54],[71,42,50,56,"stayLoggedIn"],[71,54,50,77],[71,57,50,80],[71,61,50,84],[71,66,50,89],[72,6,51,4],[72,10,51,8],[73,8,52,6],[73,14,52,12],[74,10,52,14,"user"],[75,8,52,19],[75,9,52,20],[75,12,52,23],[75,18,52,29,"authService"],[75,29,52,40],[75,30,52,40,"default"],[75,37,52,40],[75,38,52,41,"login"],[75,43,52,46],[75,44,52,47],[76,10,52,49,"email"],[76,15,52,54],[77,10,52,56,"password"],[78,8,52,65],[78,9,52,66],[78,11,52,68,"stayLoggedIn"],[78,23,52,80],[78,24,52,81],[79,8,53,6,"setUser"],[79,15,53,13],[79,16,53,14,"user"],[79,20,53,18],[79,21,53,19],[81,8,55,6],[82,8,56,6],[82,12,56,10,"user"],[82,16,56,14],[82,17,56,15,"needs_consent"],[82,30,56,28],[82,32,56,30],[83,10,57,8,"setShowConsentModal"],[83,29,57,27],[83,30,57,28],[83,34,57,32],[83,35,57,33],[84,8,58,6],[86,8,60,6],[87,8,61,6],[88,8,62,6],[88,12,62,6,"registerForPushNotificationsAsync"],[88,41,62,39],[88,42,62,39,"registerForPushNotificationsAsync"],[88,75,62,39],[88,77,62,40],[88,78,62,41],[88,79,62,42,"catch"],[88,84,62,47],[88,85,62,49,"error"],[88,90,62,54],[88,94,62,59],[89,10,63,8,"console"],[89,17,63,15],[89,18,63,16,"error"],[89,23,63,21],[89,24,63,22],[89,68,63,66],[89,70,63,68,"error"],[89,75,63,73],[89,76,63,74],[90,8,64,6],[90,9,64,7],[90,10,64,8],[91,6,65,4],[91,7,65,5],[91,8,65,6],[91,15,65,13,"error"],[91,20,65,23],[91,22,65,25],[92,8,66,6],[92,14,66,12],[92,18,66,16,"Error"],[92,23,66,21],[92,24,66,22,"error"],[92,29,66,27],[92,30,66,28,"response"],[92,38,66,36],[92,40,66,38,"data"],[92,44,66,42],[92,46,66,44,"detail"],[92,52,66,50],[92,56,66,54],[92,70,66,68],[92,71,66,69],[93,6,67,4],[94,4,68,2],[94,5,68,3],[95,4,70,2],[95,10,70,8,"handleConsentAccepted"],[95,31,70,29],[95,34,70,32,"handleConsentAccepted"],[95,35,70,32],[95,40,70,38],[96,6,71,4,"setShowConsentModal"],[96,25,71,23],[96,26,71,24],[96,31,71,29],[96,32,71,30],[97,6,72,4],[98,6,73,4],[98,10,73,8,"user"],[98,14,73,12],[98,16,73,14],[99,8,74,6,"setUser"],[99,15,74,13],[99,16,74,13,"Object"],[99,22,74,13],[99,23,74,13,"assign"],[99,29,74,13],[99,34,74,19,"user"],[99,38,74,23],[100,10,74,25,"needs_consent"],[100,23,74,38],[100,25,74,40],[100,30,74,45],[101,10,74,47,"terms_accepted"],[101,24,74,61],[101,26,74,63],[101,30,74,67],[102,10,74,69,"privacy_policy_accepted"],[102,33,74,92],[102,35,74,94],[103,8,74,98],[103,10,74,100],[103,11,74,101],[104,6,75,4],[105,4,76,2],[105,5,76,3],[106,4,78,2],[106,10,78,8,"register"],[106,18,78,16],[106,21,78,19],[106,27,78,26,"data"],[106,31,78,35],[106,35,78,40],[107,6,79,4],[107,10,79,8],[108,8,80,6],[108,14,80,12],[109,10,80,14,"user"],[110,8,80,19],[110,9,80,20],[110,12,80,23],[110,18,80,29,"authService"],[110,29,80,40],[110,30,80,40,"default"],[110,37,80,40],[110,38,80,41,"register"],[110,46,80,49],[110,47,80,50,"data"],[110,51,80,54],[110,52,80,55],[111,8,81,6,"setUser"],[111,15,81,13],[111,16,81,14,"user"],[111,20,81,18],[111,21,81,19],[112,6,82,4],[112,7,82,5],[112,8,82,6],[112,15,82,13,"error"],[112,20,82,23],[112,22,82,25],[113,8,83,6],[113,14,83,12],[113,18,83,16,"Error"],[113,23,83,21],[113,24,83,22,"error"],[113,29,83,27],[113,30,83,28,"response"],[113,38,83,36],[113,40,83,38,"data"],[113,44,83,42],[113,46,83,44,"detail"],[113,52,83,50],[113,56,83,54],[113,77,83,75],[113,78,83,76],[114,6,84,4],[115,4,85,2],[115,5,85,3],[116,4,87,2],[116,10,87,8,"logout"],[116,16,87,14],[116,19,87,17],[116,25,87,17,"logout"],[116,26,87,17],[116,31,87,29],[117,6,88,4],[117,12,88,10,"authService"],[117,23,88,21],[117,24,88,21,"default"],[117,31,88,21],[117,32,88,22,"logout"],[117,38,88,28],[117,39,88,29],[117,40,88,30],[118,6,89,4,"storeLogout"],[118,17,89,15],[118,18,89,16],[118,19,89,17],[119,4,90,2],[119,5,90,3],[120,4,92,2],[120,10,92,8,"updateUser"],[120,20,92,18],[120,23,92,22,"updatedUser"],[120,34,92,48],[120,38,92,53],[121,6,93,4],[121,10,93,8,"user"],[121,14,93,12],[121,16,93,14],[122,8,94,6,"setUser"],[122,15,94,13],[122,16,94,13,"Object"],[122,22,94,13],[122,23,94,13,"assign"],[122,29,94,13],[122,34,94,19,"user"],[122,38,94,23],[122,40,94,28,"updatedUser"],[122,51,94,39],[122,52,94,41],[122,53,94,42],[123,6,95,4],[124,4,96,2],[124,5,96,3],[125,4,98,2],[125,24,99,4],[125,28,99,4,"_reactJsxDevRuntime"],[125,47,99,4],[125,48,99,4,"jsxDEV"],[125,54,99,4],[125,56,99,5,"AuthContext"],[125,67,99,16],[125,68,99,17,"Provider"],[125,76,99,25],[126,6,99,26,"value"],[126,11,99,31],[126,13,99,33],[127,8,99,35,"user"],[127,12,99,39],[128,8,99,41,"isLoading"],[128,17,99,50],[129,8,99,52,"isAuthenticated"],[129,23,99,67],[130,8,99,69,"login"],[130,13,99,74],[131,8,99,76,"register"],[131,16,99,84],[132,8,99,86,"logout"],[132,14,99,92],[133,8,99,94,"updateUser"],[134,6,99,105],[134,7,99,107],[135,6,99,107,"children"],[135,14,99,107],[135,16,100,7,"children"],[136,4,100,15],[137,6,100,15,"fileName"],[137,14,100,15],[137,16,100,15,"_jsxFileName"],[137,28,100,15],[138,6,100,15,"lineNumber"],[138,16,100,15],[139,6,100,15,"columnNumber"],[139,18,100,15],[140,4,100,15],[140,11,101,26],[140,12,101,27],[141,2,103,0],[141,3,103,1],[142,2,103,2,"_s"],[142,4,103,2],[142,5,19,13,"AuthProvider"],[142,17,19,66],[143,4,19,66],[143,12,20,89,"useAuthStore"],[143,27,20,101],[143,28,20,101,"useAuthStore"],[143,40,20,101],[144,2,20,101],[145,2,20,101,"_c"],[145,4,20,101],[145,7,19,13,"AuthProvider"],[145,19,19,66],[146,2,105,7],[146,8,105,13,"useAuth"],[146,15,105,20],[146,18,105,23,"useAuth"],[146,19,105,23],[146,24,105,29],[147,4,105,29,"_s2"],[147,7,105,29],[148,4,106,2],[148,10,106,8,"context"],[148,17,106,15],[148,20,106,18],[148,24,106,18,"useContext"],[148,30,106,28],[148,31,106,28,"useContext"],[148,41,106,28],[148,43,106,29,"AuthContext"],[148,54,106,40],[148,55,106,41],[149,4,107,2],[149,8,107,6],[149,9,107,7,"context"],[149,16,107,14],[149,18,107,16],[150,6,108,4],[150,12,108,10],[150,16,108,14,"Error"],[150,21,108,19],[150,22,108,20],[150,64,108,62],[150,65,108,63],[151,4,109,2],[152,4,110,2],[152,11,110,9,"context"],[152,18,110,16],[153,2,111,0],[153,3,111,1],[154,2,111,2,"_s2"],[154,5,111,2],[154,6,105,13,"useAuth"],[154,13,105,20],[155,2,105,20],[155,6,105,20,"_c"],[155,8,105,20],[156,2,105,20,"$RefreshReg$"],[156,14,105,20],[156,15,105,20,"_c"],[156,17,105,20],[157,0,105,20],[157,3]],"functionMap":{"names":["<global>","AuthProvider","useEffect$argument_0","checkAuth","login","registerForPushNotificationsAsync._catch$argument_0","handleConsentAccepted","register","logout","updateUser","useAuth"],"mappings":"AAA;qECkB;YCI;GDE;oBEE;GFqB;gBGE;gDCY;ODE;GHI;gCKE;GLM;mBME;GNO;iBOE;GPG;qBQE;GRI;CDO;uBUE;CVM"},"hasCjsExports":false},"type":"js/module"}]}